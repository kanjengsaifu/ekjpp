<?php
defined('BASEPATH') OR exit('No direct script access allowed');
/*
 */
class Home extends My_Controller {
	    var $private_key ='b1m5';
    function __construct(){
        parent::__construct();
        $this->load->model('dashboard_model','app_model');
        $this->load->model('simstan/simstan_model');
    }
    public function index_old()
    {
     $this->load->model('global_model');
	 $show_alert = $this->session->userdata('show_alert');
     $alert_message = NULL;
        if ( !$show_alert ) {
            $list_app = $this->global_model->get_list('tbl_log');
            foreach ($list_app as $app) {
                if (!empty($app->waktu)) {
                    $d1 = new DateTime($app->waktu);
                    $d2 = new DateTime(date('Y-m-d'));
                    $div = $d1->diff($d2)->m + ($d1->diff($d2)->y*12);
                    if ( $div >= 1 ) {
                        $alert_message .= "Aplikasi <b>".strtoupper($app->sinkronisasi)."</b> terakhir update pada tanggal ".format_datetime($app->waktu)."<br/>";
                    }
                } else {
                    $alert_message .= "Aplikasi <b>".strtoupper($app->sinkronisasi)."</b> belum sinkronisasi<br/>";
                }
            }
            $show_alert = true;
            $this->session->set_userdata('show_alert', true);
        } 
        $data['alert_message'] = $alert_message;
        $tahun = $this->input->get('tahun');
        $tahun = empty($tahun) ? date('Y') : $tahun;
        $pusat_litbang = $this->input->get('pusat_litbang');
        $pusat_litbang = empty($pusat_litbang) ? 'Pus Air' : $pusat_litbang;
        $this->load->library('highcharts');
        //Data
        $data_report = array(
            array(
                'pusat_litbang'     => '01',
                'jumlah'    => 20000000 
            ),
            array(
                'pusat_litbang'     => '02',
                'jumlah'    => 30000000 
            ),
            array(
                'pusat_litbang'     => '03',
                'jumlah'    => 40000000 
            ),
        );
        $data_report = json_decode(json_encode($data_report), false);
        $result_report = array();

        //Sumbu X (Bulan)
        $list_bulan = get_list_bulan();
        $string_nama_bulan = '[';
        foreach ($list_bulan as $key => $value) {
            $nm_bulan = get_nm_bulan($key);
            $result_report[$key] = 0;
            $string_nama_bulan .= '\''.$nm_bulan.'\', ';
        }
        $string_nama_bulan = rtrim($string_nama_bulan, ', ');
        $string_nama_bulan .= ']';

        //Sumbu Y (Jumlah)
        foreach ($data_report as $report) {
            $result_report[$report->pusat_litbang] = $report->jumlah;
        }

        //Generate String Sumbu Y
        $string_jumlah = '[';
        foreach ($result_report as $item) {
            $string_jumlah .= $item.',';
        }
        $string_jumlah = rtrim($string_jumlah,',');
        $string_jumlah .= ']';

        /** Presntasi SNI Perbidang **/
        $tahun_simstan = '';
        $presentase_perbidang = $this->simstan_model->presentase_perbidang($tahun_simstan);
        
        $total_presentase_pusair = $presentase_perbidang['total_presentase_pusair'];
        $total_presentase_pusjatan = $presentase_perbidang['total_presentase_pusjatan'];
        $total_presentase_puskim = $presentase_perbidang['total_presentase_puskim'];
        $total_presentase_umum = $presentase_perbidang['total_presentase_umum'];

        $presentase_tahun_pusair = $this->simstan_model->presentase_pertahun('01');
        $presentase_tahun_pusjatan = $this->simstan_model->presentase_pertahun('02');
        $presentase_tahun_puskim = $this->simstan_model->presentase_pertahun('03');
        $presentase_tahun_umum = $this->simstan_model->presentase_pertahun('04');
        /* End Presentase SNI */

        $script = 		'$(function () {
        ' . "$('#dashboard_home_1').jDashboard({ storageID: '".$this->session->userdata('id_admin')."',storageScript:'".base_url()."storage.php' });
		 });". '
            Highcharts.setOptions({
                colors: [\'#006994\', \'#FFF028\', \'#EF7321\', \'#2ED1A2\', \'#F7C604\', \'#b30059\', \'#8a8a5c\', \'#00a3cc\', \'#e62e00\']
            });

            $(function () {
                $(\'#grafik_simlab_tahun\').highcharts({
                    chart: {
                        type: \'pie\',
                        options3d: {
                            enabled: true,
                            alpha: 45,
                            beta: 0
                        }
                    },
                    title: {
                        text: \'\'
                    },
                    tooltip: {
                        pointFormat: \'{series.name}: <b>{point.percentage:.1f}%</b>\'
                    },
                    plotOptions: {
                        pie: {
                            allowPointSelect: true,
                            cursor: \'pointer\',
                            depth: 35,
                            dataLabels: {
                                enabled: true,
                                format: \'<b>{point.name}</b>: {point.percentage:.1f} %\',
                            },
                            showInLegend: true
                        }
                    },
                    series: [{
                        name: \'Persentase\',
                        colorByPoint: true,
                        data: [{
                            name: \'Pusair\',
                            y: 56.33
                        }, {
                            name: \'Pusjatan\',
                            y: 24.03,
                            sliced: true,
                            selected: true
                        }, {
                            name: \'Puskim\',
                            y: 30.2
                        }]
                    }]
                });
            });
            $(function () {
                $(\'#grafik_simlab_unitkerja\').highcharts({
                    chart: {
                        type: \'pie\',width : 550,
                        options3d: {
                            enabled: true,
                            alpha: 45,
                            beta: 0
                        }
                    },
                    title: {
                        text: \'\'
                    },
                    tooltip: {
                        pointFormat: \'{series.name}: <b>{point.percentage:.1f}%</b>\'
                    },
                    plotOptions: {
                        pie: {
                            allowPointSelect: true,
                            cursor: \'pointer\',
                            depth: 35,
                            dataLabels: {
                                enabled: true,
                                format: \'<b>{point.name}</b>: {point.percentage:.1f} %\',
                            },
                            showInLegend: true
                        }
                    },
                    series: [{
                        name: \'Persentase\',
                        colorByPoint: true,
                        data: [{
                            name: \'2015\',
                            y: 56.33
                        }, {
                            name: \'2016\',
                            y: 24.03,
                            sliced: true,
                            selected: true
                        }, {
                            name: \'2017\',
                            y: 30.2
                        }]
                    }]
                });
            });

            //Grafik simstan tahun
            $(function () {
                
var chart_simstan = new Highcharts.Chart({"series":[{"name":0}],"chart":{"renderTo":"grafik_simstan_tahun","type":"pie","options3d":{"enabled":true,"alpha":45,"beta":0}},"title":{"text":"SDM BALITBANG"}});
            });
            $(function () {
                $(\'#grafik_simstan_unitkerja\').highcharts({
                    chart: {
                        type: \'pie\',
                        options3d: {
                            enabled: true,
                            alpha: 45,
                            beta: 0
                        }
                    },
                    title: {
                        text: \'\'
                    },
                    tooltip: {
                        pointFormat: \'{series.name}: <b>{point.percentage:.1f}%</b>\'
                    },
                    plotOptions: {
                        pie: {
                            allowPointSelect: true,
                            cursor: \'pointer\',
                            depth: 35,
                            dataLabels: {
                                enabled: true,
                                format: \'<b>{point.name}</b>: {point.percentage:.1f} %\',
                            },
                            showInLegend: true
                        }
                    },
                    series: [{
                        name: \'Persentase\',
                        colorByPoint: true,
                        data: [{
                            name: \'2015\',
                            y: '.$presentase_tahun_pusair['01']['2015'].'
                        }, {
                            name: \'2016\',
                            y: '.$presentase_tahun_pusair['01']['2016'].',
                            sliced: true,
                            selected: true
                        }, {
                            name: \'2017\',
                            y: '.$presentase_tahun_pusair['01']['2017'].'
                        }]
                    }]
                });
            });

            $(function () {
                $(".cmb_select2").select2({
                    theme: "bootstrap",
                    width: "100%"
                });
                Highcharts.chart(\'grafik_epulsa_tahun\', {
                    chart: {
                        type: "column"
                    },
                    title: {
                        text: \'\'
                    },
                    yAxis: {
                        title: {
                            text: \'Jumlah\'
                        },
                    },
                    legend: {
                        enabled: true
                    },
                    xAxis: {
                        categories: [
                            \'\',
                        ],
                        title: {
                            text: \'Pusat Litbang\'
                        }
                    },
                    series: [{
                        name: \'Pusair\',
                        data: [30000000]
                    },{
                        name: \'Pusjatan\',
                        data: [60000000]
                    },{
                        name: \'Puskim\',
                        data: [40000000]
                    }]
                });
                Highcharts.chart(\'grafik_esatker_tahun\', {
                    chart: {
                        type: "column"
                    },
                    title: {
                        text: \'\'
                    },
                    yAxis: {
                        title: {
                            text: \'Jumlah\'
                        },
                    },
                    legend: {
                        enabled: true
                    },
                    xAxis: {
                        categories: [
                            \'\'
                        ],
                        title: {
                            text: \'Pusat Litbang\'
                        }
                    },
                    series: [{
                        name: \'Pusair\',
                        data: [30000000]
                    },{
                        name: \'Pusjatan\',
                        data: [60000000]
                    },{
                        name: \'Puskim\',
                        data: [45000000]
                    },{
                        name: \'PKPT\',
                        data: [70000000]
                    },{
                        name: \'Setba\',
                        data: [60000000]
                    }]
                });
            });
            $(function () {
                $(".cmb_select2").select2({
                    theme: "bootstrap",
                    width: "100%"
                });
                Highcharts.chart(\'grafik_epulsa_unitkerja\', {
                    chart: {
                        type: "column"
                    },
                    title: {
                        text: \'\'
                    },
                    yAxis: {
                        title: {
                            text: \'Jumlah\'
                        },
                    },
                    legend: {
                        enabled: true
                    },
                    xAxis: {
                        categories: [
                            \'\',
                        ],
                        title: {
                            text: \'Tahun\'
                        }
                    },
                    series: [{
                        name: \'2013\',
                        data: [30000000]
                    },{
                        name: \'2014\',
                        data: [20000000]
                    },{
                        name: \'2015\',
                        data: [50000000]
                    },{
                        name: \'2016\',
                        data: [40000000]
                    },{
                        name: \'2017\',
                        data: [60000000]
                    }]
                });
                Highcharts.chart(\'grafik_esatker_unitkerja\', {
                    chart: {
                        type: "column"
                    },
                    title: {
                        text: \'\'
                    },
                    yAxis: {
                        title: {
                            text: \'Jumlah\'
                        },
                    },
                    legend: {
                        enabled: true
                    },
                    xAxis: {
                        categories: [
                            \'\'
                        ],
                        title: {
                            text: \'Tahun\'
                        }
                    },
                    series: [{
                        name: \'2013\',
                        data: [60000000]
                    },{
                        name: \'2014\',
                        data: [40000000]
                    },{
                        name: \'2015\',
                        data: [20000000]
                    },{
                        name: \'2016\',
                        data: [50000000]
                    },{
                        name: \'2017\',
                        data: [30000000]
                    }]
                });
            });';

        $data['list_widget']    =   $this->app_model->get_widget();

        $data['pusat_litbang'] = $pusat_litbang;
        $data['tahun'] = $tahun;
        $data['title'] = 'Layanan dan Jumlah Layanan';
        $this->template->add_css('resources/plugins/select2/select2.min.css');
        $this->template->add_css('resources/plugins/select2/select2-bootstrap.min.css');
        $this->template->add_js('resources/plugins/select2/placeholders.jquery.min.js');
        $this->template->add_js('resources/plugins/select2/select2.min.js');
        $this->template->add_js('resources/plugins/highcharts/highcharts.js');
        $this->template->add_js('resources/plugins/highcharts/exporting.js');
        $this->template->add_js('resources/plugins/highcharts/highcharts-3d.js');
		$this->template->add_css('resources/js/jdashboard/jdashboard.min.css');
		$this->template->add_js('resources/js/jdashboard/jdashboard.min.js');
        $this->template->add_js($script,'embed');
        $this->template->write('title', $data['title']);
        $this->template->write_view('content', 'dashboard', $data, true);
        $this->template->render();
    }
    function change_password() {
        $this->load->model('login_model');
        if ( isset($_POST['btn_simpan']) ) {
            $id_user            = $this->session->userdata('id_admin');
            $password_lama      = $this->input->post('password_lama');
            $password_baru      = $this->input->post('password_baru');
            $ulangi_password    = $this->input->post('ulangi_password');

            $check_password     = $this->login_model->check_password($id_user, $password_lama);

            if ( !$check_password ) {
                $this->session->set_flashdata('msg_change_password', 'Password lama tidak valid');
            } else if ( empty($password_baru) ) {
                $this->session->set_flashdata('msg_change_password', 'Password baru masih kosong');
            } else if ( $password_baru  != $ulangi_password ) {
                $this->session->set_flashdata('msg_change_password', 'Pengulangan tidak valid');
            } else {
                $data_update    = array(
                    'password' => strrev(md5($password_baru))
                );
                $update = $this->login_model->update_user($id_user, $data_update);
                $this->session->set_flashdata('msg_change_password', 'Password berhasil diubah');
            }
            redirect(base_url().'home/change_password');
        }

        $data['msg_change_password']    = $this->session->flashdata('msg_change_password');
        $data['breadcrumb']             = array(
            array(
                'label' => 'Ubah Password',
                'link'  => NULL
            )
        );
        $data['active_breadcrumb']      = 'Ubah Password';
        $this->template->write('title', 'Ubah Password');
        $this->template->write_view('content', 'change_password', $data, true);
        $this->template->render();
    }
	
	function index(){
		$this->load->library('highcharts');
		$this->load->model('global_model');
        $script = "";

		$show_alert = $this->session->userdata('show_alert');
     		$alert_message = NULL;
        if ( !$show_alert ) {
            $list_app = $this->global_model->get_list('tbl_log');
            foreach ($list_app as $app) {
                if (!empty($app->waktu)) {
                    $d1 = new DateTime($app->waktu);
                    $d2 = new DateTime(date('Y-m-d'));
                    $div = $d1->diff($d2)->m + ($d1->diff($d2)->y*12);
                    if ( $div >= 1 ) {
                        $alert_message .= "Aplikasi <b>".strtoupper($app->sinkronisasi)."</b> terakhir update pada tanggal ".format_datetime($app->waktu)."<br/>";
                    }
                } else {
                    $alert_message .= "Aplikasi <b>".strtoupper($app->sinkronisasi)."</b> belum sinkronisasi<br/>";
                }
            }
            $show_alert = true;
            $this->session->set_userdata('show_alert', true);
        } 


		$data = array();        
              $data['alert_message'] = $alert_message;
		$list_widget = $this->app_model->get_widget();
		$i=0;
		$tahun = $this->input->get('tahun');
        $tahun = isset($tahun) ? $tahun : date('Y')-1;
		
		
		// widget 1 simren
		$dt_simren = $this->simren_widget();
		$dt_widget_1 = $this->format_chart($dt_simren[0],$dt_simren[1]);

		// widget 2 simka
		//$data['total_pegawai_kelamin'] = trf_send_request($uri_services, $this->private_key, $get_gender, $get_gender['action']);
		
		// widget 3 esatker perjenis belanja
		$this->load->model('esatker/rekap_per_output_model', 'widget3_model');
		$list_anggaran_jenis_belanja = $this->widget3_model->get_list_anggaran_peroutput('',$tahun);

        //Sumbu X (jenis belanja)
		$arr_jns_belanja = array();
        $string_nama_jenis_belanja = '[';
        foreach ($list_anggaran_jenis_belanja as $ajb) {
            $arr_jns_belanja[] = $ajb['nama_output'];
        }
        // var_dump($string_nama_jenis_belanja);exit();

        //Sumbu Y (anggaran)
        $dt_nilai = array();  
        foreach ($list_anggaran_jenis_belanja as $ajb) {
            $dt_nilai[] = (int)$ajb['jumlah_anggaran'];
        }
		// untuk chart dengan lebih dari 1 series nilai masukkan di array dengan namanya
		$dt_list_nilai = array(0=>array('name'=>'Output','data'=>$dt_nilai));
		$dt_widget_3 = $this->format_chart($arr_jns_belanja,$dt_list_nilai);
		

		// widget simstan
		/** Presntasi SNI Perbidang **/

        $tahun_kebelakang = $tahun;
        $total_perbidang_kebelakang = $this->simstan_model->total_sni_perbidang_tahun_kebelakang($tahun_kebelakang);
        $dt_kategori = array('SDA','JATAN','PERKIM','UMUM');
        $dt_nilai = array(
            (int)$total_perbidang_kebelakang['sda'],
            (int)$total_perbidang_kebelakang['jatan'],
            (int)$total_perbidang_kebelakang['perkim'],
            (int)$total_perbidang_kebelakang['umum']
        );

		// untuk chart dengan lebih dari 1 series nilai masukkan di array dengan namanya
		$dt_list_nilai = array(0=>array('name'=>'Pusat Litbang','data'=>$dt_nilai));
		// set data chart
		$dt_widget_4 = $this->format_chart($dt_kategori,$dt_list_nilai);
		
		// ====== BEGIN WIDGET 5 EMONEV =======
		$this->load->model('global_model');
		$rekap_kegiatan = $this->global_model->get_list('rekap_kegiatan_keseluruhan','tahun='.$tahun);
        $rekap_kegiatan = $this->global_model->get_list('rekap_kegiatan_keseluruhan','tahun='.$tahun);

        foreach ($rekap_kegiatan as $key) {
            $data_pagu[] = round($key->paguPaket,2);
            $data_realisasi[] = round($key->realisasiTotal,2);
            $data_pus[] = "'".$key->name."'";
        }  

		$dt_list_nilai = array(0=>array('name'=>'pagu','data'=>$data_pagu),1=>array('name'=>'realisasi','data'=>$data_realisasi)); 
		//var_dump($dt_list_nilai);
		$dt_widget_5 = $this->format_chart($data_pus,$dt_list_nilai);
		// ====== END WIDGET 5 EMONEV =======
 

        $presentase_tahun_pusair = $this->simstan_model->presentase_pertahun('01');
        $presentase_tahun_pusjatan = $this->simstan_model->presentase_pertahun('02');
        $presentase_tahun_puskim = $this->simstan_model->presentase_pertahun('03');
        $presentase_tahun_umum = $this->simstan_model->presentase_pertahun('04');
        /* End Presentase SNI */
		
		/* BEGIN WIDGET 6 SIMKA */
        $this->load->model('simka/rekap_pegawai_model');
		$total_pegawai_kelamin = $this->rekap_pegawai_model->rekap_gender('%');
        $dt_kategori = array('LAKI LAKI','PEREMPUAN');
        $dt_nilai_kelamin = array(
            (int)$total_pegawai_kelamin['laki_laki'],
            (int)$total_pegawai_kelamin['perempuan'],
        );

        // untuk chart dengan lebih dari 1 series nilai masukkan di array dengan namanya
        $dt_list_nilai = array(0=>array('name'=>'Jenis Kelamin','data'=>$dt_nilai_kelamin));
        // set data chart
        $dt_widget_6 = $this->format_chart($dt_kategori,$dt_list_nilai);

		/* END WIDGET 6 */
		$arr_color_pus =  array('#0066ff','#fff028','#EF7321','#f7c604','#2ED1A2','#cc6699');
		$arr_color_general = array('#7CB5EC','#ffff33','#90ED7D','#F7A35C','#8085E9','#F15C80','#E4D354','#2B908F','#F45B5B','##9900cc');
		foreach($list_widget as $widget){
			$id_widget = $widget->id_widget;
			$tipe = $widget->tipe;
			$label_y = $widget->label_y;
			$label_x = $widget->label_x;
			$keterangan = strtoupper($widget->keterangan);
			if($tipe=='pie' || $tipe=='donut'){
				$this->highcharts->set_type('pie'); 
				$this->highcharts->set_title($keterangan);
				$this->highcharts->set_color($arr_color_general);
				$this->highcharts->set_3d();
				if($tipe=='donut'){
					$this->highcharts->set_donut();
				}
				$this->highcharts->set_serie(${'dt_widget_'.$id_widget}['pie']); // nilai data series
			} else {
				//option array
				$arr_opt = array('yAxis'=>array('title'=>array('text'=>$label_y)));
				//$dat1['x_labels'] 	= 'contries'; 
				$this->highcharts->set_type($tipe); 
				$this->highcharts->set_title($keterangan);
				$this->highcharts->set_xAxis(${'dt_widget_'.$id_widget}['sumbu_x']); // array data sumbu X
				$this->highcharts->set_axis_titles($label_x,$label_y);
				if(count(${'dt_widget_'.$id_widget}['values'])==1){
					if($tipe=='column' || $tipe == 'bar'){
						$this->highcharts->set_option_color($tipe);
						$this->highcharts->set_color($arr_color_general);
					}
				} else {
					$this->highcharts->set_color($arr_color_pus);
				}
				foreach(${'dt_widget_'.$id_widget}['values'] as $series){
					$this->highcharts->set_serie($series); 	 // nilai data series
				}
			}
			$this->highcharts->render_to('widget_'.$id_widget);
			$this->highcharts->add();
			$i++;
		}
        $script .= '
        $(function(){
            $("#widget_1").append("<div style=\"margin-bottom:1rem\"><i>Sumber Data: <a href=\"http://simren.litbang.pu.go.id\" target=\"_blank\">simren.litbang.pu.go.id</a></i></div>");
            $("#widget_3").append("<div style=\"margin-bottom:1rem\"><i>Sumber Data: <a href=\"http://103.211.51.65\" target=\"_blank\">esatker.litbang.pu.go.id</a></i></div>");
            $("#widget_4").append("<div style=\"margin-bottom:1rem\"><i>Sumber Data: <a href=\"http://sni.litbang.pu.go.id/index.php?r=report/snijumlah\" target=\"_blank\">sni.litbang.pu.go.id</a></i></div>");
            $("#widget_5").append("<div style=\"margin-bottom:1rem\"><i>Sumber Data: <a href=\"http://simon.litbang.pu.go.id/#/home/lapangg\" target=\"_blank\">simon.litbang.pu.go.id</a></i></div>");
            $("#widget_6").append("<div style=\"margin-bottom:1rem\"><i>Sumber Data: <a href=\"http://litbang.pu.go.id/simka-cismart/index.php/dashboard/welcome_sa\" target=\"_blank\">litbang.pu.go.id/simka-cismart</a></i></div>");
        })
        ';

        $data['chart'] = $this->highcharts->render();
		$data['tahun'] = date('Y');
		$data['list_widget']    =   $list_widget;
		$this->template->add_js('resources/plugins/highcharts/highcharts.js');
        $this->template->add_js('resources/plugins/highcharts/exporting.js');
        $this->template->add_js('resources/plugins/highcharts/highcharts-3d.js');
        $this->template->add_js($script, "embed");
		$this->template->write('title', 'Dashboard Baru');
        $this->template->write_view('content', 'dashboard2', $data, true);
        $this->template->render();
	}
	
	function format_chart($dt_kategori,$dt_list_nilai){
		//setting format chart 
		$dt_chart = array();
		$dt_chart['sumbu_x'] = array('categories'=>$dt_kategori);
		$dt_chart['values'] = $dt_list_nilai;
		foreach($dt_list_nilai as $arr_nilai){
			$dt_nilai = $arr_nilai['data'];
		}
	
		// khusus pie chart
		$arr_combine = array_combine($dt_kategori,$dt_nilai);
		$arr_pie = array();
		
		$i = 0;
		foreach($arr_combine as $key => $val){
			$arr_pie['data'][$i] = array($key,$val);
			$i++;
		}
		$dt_chart['pie'] = $arr_pie;
		// end set up data pie 
		return $dt_chart;
	}
	
	function simren_widget(){
		$rekap_anggaran = array();
		$this->load->model('simren_model','simren_model');
        $rekap = false;
        $data_anggaran = $this->simren_model->get_data_renstra_rekap();
		// data 1 tahun renstra
        $index = 0;
        if ( $data_anggaran ) {
            $rekap_anggaran = (array)$data_anggaran;
            $list_anggaran = $this->simren_model->get_detil_renstra_rekap($data_anggaran->id_renstra);
            $result_renstra = array();
            $nomor = 1;
			$dt_kategori = array();
			$dt_series = array();
			$is_tahun = false;
			$j = 0;
            foreach ($list_anggaran as $r) {
                $anggaran = array();
 				$dt_series[$j]['name'] = $r->puslitbang;
				$data_values = array();
				$i = 1;
                for ( $tahun=$data_anggaran->tahun_awal; $tahun<=$data_anggaran->tahun_akhir; $tahun++ ) {
					
                    $column = 'tahun_'.$i;
					if(!$is_tahun){
						$dt_kategori[] = $tahun;
					}
                    //$anggaran[$tahun] = $r->$column;
					$data_values[] = (int)$r->$column;
                    $i++;
                }
				$is_tahun = true;
                $dt_series[$j]['data'] = $data_values;
                $j++;
            }
           
        }
		$hasil = array();
		$hasil[0] = $dt_kategori;
		$hasil[1] = $dt_series;
		return $hasil;
	}
	
	function simka_widget(){
        $this->load->model('simka/rekap_pegawai_model');
        $total_pegawai_kelamin = $this->rekap_pegawai_model->rekap_gender('%');
			$dt_kategori = array();
			$dt_nilai = array();
		foreach ($total_pegawai_kelamin[0] as $key => $value) {
			$dt_kategori[] = $key;
			$dt_nilai[] = (int)$value;
		}

		$dt_series = array();
		$dt_series = array(0=>array('name'=>'Jenis Kelamin','data'=>$dt_nilai));
		$hasil = array();
		$hasil[0] = $dt_kategori;
		$hasil[1] = $dt_series;
		return $hasil;
	}
	
}
